"use strict";(self.webpackChunkgame=self.webpackChunkgame||[]).push([[815],{8540:function(t,n,e){function $(t,n,e,$){var u=t,a=n,r=[];return n+$<8?(u|=e<<8-$-n,a+=$):n+$===8?(r.push(t|e),u=0,a=0):(r.push(u|=e>>n-8+$),u=e<<16-n-$&255,a=n-8+$),[u,a,r]}function u(t,n,e){var $=n%8,u=Math.floor(n/8);if($+e>8&&u+1>=t.length||$+e<=8&&u>=t.length)throw Error("readBitsError");var a=$+e<=8?t[u]:t[u]<<8|t[u+1];return a>>=($+e<=8?8:16)-e-$,[a&=[0,1,3,7,15,31,63,127][e],n+e]}e.d(n,{F:function(){return $},l:function(){return u}})},1626:function(t,n,e){e.r(n),e.d(n,{default:function(){return L}});var $=e(7313),u=e(5982),a=e(7992),r=e(3032),c=e(882),i=e(4942),o=e(1413),s=e(6417),l=$.memo(function t(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{stroke:"#272E3B",strokeWidth:"0.35",fill:"none",d:"m-50,-50h100v100h-100zm10,0v100m10,0v-100m10,0v100m10,0v-100m10,0v100m10,0v-100m10,0v100m10,0v-100m10,0v100m10,-10h-100m0,-10h100m0,-10h-100m0,-10h100m0,-10h-100m0,-10h100m0,-10h-100m0,-10h100m0,-10h-100"}),[1,2,3,4,5,6,7,8,9,10].map(function(t){return(0,s.jsx)("text",{alignmentBaseline:"central",dominantBaseline:"central",textAnchor:"middle",fontSize:"3",x:"-54",y:55-10*t,children:t},t)}),Array.from("ABCDEFGHIJ").map(function(t,n){return(0,s.jsx)("text",{alignmentBaseline:"central",dominantBaseline:"central",textAnchor:"middle",fontSize:"3",x:10*n-45,y:"54",children:t},t)})]})}),f=e(2982),d=e(885),_=e(7658),h=function(t){var n=t.zfjRule,e=t.matrix,$=t.cx,u=t.cy,a=t.x,r=t.y,c=t.d,i=t.select,o=t.onClick,l=t.centerMark,f=(0,_._B)(e,$,u,c),h=(0,d.Z)(f,3),m=h[0],p=h[1],x=h[2],v=a-p,b=r-x,y=[];return m.forEach(function(t,e){t.forEach(function(t,$){t&&y.push((0,s.jsx)("rect",{width:"10",height:"10",fill:n&&$===p&&e===x?"#f53f3fdd":"#23c343cc",stroke:i?"#165dff":void 0,strokeWidth:"0.7",x:10*(v+$)-50,y:10*(b+e)-50},($<<3)+e))})}),(0,s.jsxs)("g",{onClick:o,className:o?"cursor-pointer":"",children:[y,l&&(0,s.jsx)("text",{x:10*a-45,y:10*r-45,fontSize:"4",fill:"#000000",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:"○"})]})},m=e(4420),p=e(8540),x=e(3366);function v(t,n){for(var e,$=0;$<9999;$++){var u=function($){var u=!0;e=[];for(var a=new Set,r=0;r<n.length;r++){for(var c=n[r],i=!1,o=0;o<9999;o++){var s=Math.floor(4*(0,m.Z)()),l=Math.floor(10*(0,m.Z)()),f=Math.floor(10*(0,m.Z)()),h=(0,_.xU)(c[0],c[1],c[2],s,l,f),p=(0,d.Z)(h,1)[0];if(!(p.findIndex(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1];return e<0||e>9||$<0||$>9||a.has("".concat(e,",").concat($))})>=0)){t?p.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1];return a.add("".concat(e,",").concat($))}):p.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1];a.add("".concat(e,",").concat($)),a.add("".concat(e-1,",").concat($)),a.add("".concat(e,",").concat($-1)),a.add("".concat(e+1,",").concat($)),a.add("".concat(e,",").concat($+1)),a.add("".concat(e-1,",").concat($-1)),a.add("".concat(e+1,",").concat($-1)),a.add("".concat(e-1,",").concat($+1)),a.add("".concat(e+1,",").concat($+1))}),i=!0,e.push([l,f,s]);break}}if(!i){u=!1;break}}if(u)return{v:e}}();if("object"==typeof u)return u.v}return window.alert("随机排列布局失败，建议让房主结束游戏，修改自定义配置"),[]}var b=$.memo(function(t){var n=t.x,e=t.y,$=t.w,u=t.h,a=t.t,r=t.onClick,c=u/2;return(0,s.jsxs)("g",{className:"zfj-button-wrapper",onClick:r,children:[(0,s.jsx)("rect",{className:"zfj-button",width:$,height:u,rx:c,ry:c,x:n-c,y:e-c,filter:"drop-shadow(0 1 0.7 rgb(0 0 0 / 0.4))"}),(0,s.jsx)("text",{x:n,y:e,fontSize:"4",fill:"#000000",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:a})]})}),y=function(t){var n,e=t.position,u=t.game,a=t.updateGameData,c=(0,$.useState)(-1),i=(0,d.Z)(c,2),o=i[0],l=i[1],m=!(1&u.rule),y=(0,_.xA)(m),j=(0,_.IH)(u.planeList,u.planeCount),g=(0,$.useState)(function(){return v(m,j)}),Z=(0,d.Z)(g,2),L=Z[0],k=Z[1],w=[];return j.forEach(function(t,n){var e=L[n];w.push((0,s.jsx)(h,{select:o===n,centerMark:!0,zfjRule:m,matrix:t[0],cx:t[1],cy:t[2],x:e[0],y:e[1],d:e[2],onClick:function(){return l(o===n?-1:n)}},n))}),(0,s.jsxs)(s.Fragment,{children:[w,!(null!==(n=u.layoutList[e-1])&&void 0!==n&&n.length)&&(0,s.jsxs)(s.Fragment,{children:[[[-30,56,"↑",0,-1],[-39,65,"←",-1,0],[-30,65,"○",0,0],[-21,65,"→",1,0],[-30,74,"↓",0,1]].map(function(t,n){return(0,s.jsx)(b,{w:6.6,h:6.6,x:t[0],y:t[1]+2,t:t[2],onClick:function(){if(o<0)return(0,x.Z)("请先选中要移动的".concat(y));var e=j[o],$=(0,f.Z)(L);if(2===n){for(var u=!1,a=0;a<3;a++){$[o]=[$[o][0],$[o][1],$[o][2]+1&3];var r=(0,d.Z)($[o],3),c=r[0],i=r[1],s=r[2],l=(0,_.xU)(e[0],e[1],e[2],s,c,i);if(0>(0,d.Z)(l,1)[0].findIndex(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1];return e<0||e>9||$<0||$>9})){u=!0;break}}if(!u)return(0,x.Z)("无法旋转")}else{$[o]=[$[o][0]+t[3],$[o][1]+t[4],$[o][2]];var h=(0,d.Z)($[o],3),m=h[0],p=h[1],v=h[2],b=(0,_.xU)(e[0],e[1],e[2],v,m,p);if((0,d.Z)(b,1)[0].findIndex(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1];return e<0||e>9||$<0||$>9})>=0)return(0,x.Z)("无法移动")}k($)}},n)}),(0,s.jsxs)("g",{className:"zfj-button-wrapper",onClick:function(){var t=v(m,j);t.length&&k(t)},children:[(0,s.jsx)("rect",{className:"zfj-button",width:"24",height:"6",rx:"3",ry:"3",x:"-9",y:"64",filter:"drop-shadow(0 1 0.7 rgb(0 0 0 / 0.4))"}),(0,s.jsx)("text",{x:"3",y:"67",fontSize:"3.8",fill:"#000000",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:"随机排列"})]}),(0,s.jsxs)("g",{className:"zfj-button-wrapper",onClick:function(){if(!function(t,n,e){for(var $=new Set,u=0;u<n.length;u++){var a=n[u],r=(0,d.Z)(e[u],3),c=r[0],i=r[1],o=r[2],s=(0,_.xU)(a[0],a[1],a[2],o,c,i),l=(0,d.Z)(s,1)[0];if(l.findIndex(function(t){var n=(0,d.Z)(t,2),e=n[0],u=n[1];return e<0||e>9||u<0||u>9||$.has("".concat(e,",").concat(u))})>=0)return!1;t?l.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],u=n[1];return $.add("".concat(e,",").concat(u))}):l.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],u=n[1];$.add("".concat(e,",").concat(u)),$.add("".concat(e-1,",").concat(u)),$.add("".concat(e,",").concat(u-1)),$.add("".concat(e+1,",").concat(u)),$.add("".concat(e,",").concat(u+1)),$.add("".concat(e-1,",").concat(u-1)),$.add("".concat(e+1,",").concat(u-1)),$.add("".concat(e-1,",").concat(u+1)),$.add("".concat(e+1,",").concat(u+1))})}return!0}(m,j,L))return(0,x.Z)(m?"飞机不可以重叠":"战舰不可以重叠、相邻（包括8个方向）");l(-1);var t,n,$=null!==(t=u.layoutList[2-e])&&void 0!==t&&t.length?r.U.WaitBoth:r.U.Layout,c=(0,f.Z)(u.layoutList),i=[],o=0,s=0;L.forEach(function(t){var e=(0,d.Z)(t,3),$=e[0],u=e[1],a=e[2],r=(0,p.F)(s,o,$,4),c=(0,d.Z)(r,3);s=c[0],o=c[1],n=c[2],i.push.apply(i,(0,f.Z)(n));var l=(0,p.F)(s,o,u,4),_=(0,d.Z)(l,3);s=_[0],o=_[1],n=_[2],i.push.apply(i,(0,f.Z)(n));var h=(0,p.F)(s,o,a,2),m=(0,d.Z)(h,3);s=m[0],o=m[1],n=m[2],i.push.apply(i,(0,f.Z)(n))}),o&&i.push(s),c[e-1]=Uint8Array.from(i);var h=Uint8Array.from(Array(13).fill(0));a({state:$,layoutList:c,attackList:$?[h,h]:[],lastAttackList:[0,0],round:$?1:0})},children:[(0,s.jsx)("rect",{className:"zfj-primary-button",width:"24",height:"6",rx:"3",ry:"3",x:"22",y:"64",filter:"drop-shadow(0 1 0.7 rgb(0 0 0 / 0.4))"}),(0,s.jsx)("text",{x:"34",y:"67",fontSize:"3.8",fill:"#ffffff",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:"确认布局"})]})]})]})},j=function(t){var n,e=t.playerId,$=t.game,u=t.updateGameData,a=t.canBoom,c=(0,_.IH)($.planeList,$.planeCount),i=[],o=!(1&$.rule),l=o?0:c.reduce(function(t,n){var e,$;return t+(e=n[0],$=0,e.forEach(function(t){t.forEach(function(t){t&&$++})}),$)},0),m=$.layoutList[e],x=0,v=new Set,b=new Set,y=[];c.forEach(function(t,e){var $=[],u=(0,p.l)(m,x,4),a=(0,d.Z)(u,2);n=a[0],x=a[1];var r=n,c=(0,p.l)(m,x,4),l=(0,d.Z)(c,2);n=l[0],x=l[1];var f=n,j=(0,p.l)(m,x,2),g=(0,d.Z)(j,2);n=g[0],x=g[1],i.push((0,s.jsx)(h,{zfjRule:o,matrix:t[0],cx:t[1],cy:t[2],x:r,y:f,d:n},e));var Z=(0,_.xU)(t[0],t[1],t[2],n,r,f),L=(0,d.Z)(Z,1)[0];o&&b.add("".concat(r,",").concat(f)),L.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],u=n[1];v.add("".concat(e,",").concat(u)),$.push([e,u])}),y.push($)});var j=$.attackList[e],g=[],Z=[];x=0;for(var L=0,k=0;k<10;k++){for(var w=[],C=0;C<10;C++){var N=(0,p.l)(j,x,1),B=(0,d.Z)(N,2);if(n=B[0],x=B[1],w.push(n),n){var A="".concat(k,",").concat(C);g.splice(0,0,[k,C,b.has(A)?3:v.has(A)?2:1]),(o?b.has(A):v.has(A))&&L++}else a&&g.push([k,C,0])}Z.push(w)}o||y.forEach(function(t){var n=!0;t.forEach(function(t){var e=(0,d.Z)(t,2),$=e[0],u=e[1];Z[$][u]||(n=!1)}),n&&t.forEach(function(t){var n=(0,d.Z)(t,2),e=n[0],$=n[1],u=g.find(function(t){return t[0]===e&&t[1]===$});u&&(u[2]=3)})});var W=($.lastAttackList[e]||0)-1;return(0,s.jsxs)(s.Fragment,{children:[i,g.map(function(t){var n=(0,d.Z)(t,3),a=n[0],i=n[1],_=n[2];return(0,s.jsx)("rect",{className:_?"":"zfj-boom",x:10*a-50,y:10*i-50,width:"10",height:"10",fill:["#00000000","#ccc","#23c343cc","#f53f3fdd"][_],stroke:_?"#165dff":void 0,strokeWidth:"0.7",onClick:_?void 0:function(){for(var t,n=[],s=0,_=0,h=0;h<10;h++)for(var m=0;m<10;m++){var x=(0,p.F)(_,s,Z[h][m]||h===a&&m===i?1:0,1),y=(0,d.Z)(x,3);_=y[0],s=y[1],t=y[2],n.push.apply(n,(0,f.Z)(t))}s&&n.push(_);var j=(0,f.Z)($.attackList);j[e]=Uint8Array.from(n);var g=(0,f.Z)($.lastAttackList);g[e]=a+16*i+1;var k=$.state===r.U.WaitBoth?e?r.U.WaitPlayer2:r.U.WaitPlayer1:r.U.WaitBoth,w="".concat(a,",").concat(i);(o?b.has(w)&&L+1>=c.length:v.has(w)&&L+1>=l)&&(k=e?r.U.Player1Win:r.U.Player2Win),u({state:k,attackList:j,lastAttackList:g,round:$.state===r.U.WaitBoth&&k<r.U.Player1Win?$.round:$.round+1})}},(i<<4)+a)}),W>=0&&(0,s.jsx)("rect",{x:W%16*10-50+3,y:10*Math.floor(W/16)-50+3,width:"4",height:"4",fill:"#165dff"})]})},g=$.memo(function t(n){var e,$=n.game,a=n.room,f=n.send,d=$.state,_=!!a.position,h=function(t){f(u.Z.PlayerUpdateGameData,{data:c.f.encode((0,o.Z)((0,o.Z)({},$),t)).finish()})},m=(e={},(0,i.Z)(e,r.U.Layout,""),(0,i.Z)(e,r.U.WaitPlayer1,"等玩家1炸"),(0,i.Z)(e,r.U.WaitPlayer2,"等玩家2炸"),(0,i.Z)(e,r.U.WaitBoth,"等玩家1和玩家2炸"),(0,i.Z)(e,r.U.Player1Win,"玩家1胜利"),(0,i.Z)(e,r.U.Player2Win,"玩家2胜利"),e)[d];d||(m=$.layoutList[0].length?"等玩家2布局":$.layoutList[1].length?"等玩家1布局":"等玩家1和玩家2布局"),_&&("等你炸"===(m=1===a.position?m.replace("玩家1","你"):m.replace("玩家2","你"))?m="对方已炸，等你炸":"你胜利"===m&&(m="\ud83c\udf89 恭喜获胜"));var p=m.includes("等你")||m.includes("和你");return(0,s.jsxs)(s.Fragment,{children:[(!d||!_)&&(0,s.jsx)("div",{className:"mt-2 text-xl flex justify-center",children:(0,s.jsx)("span",{className:"".concat(p?"animate-bounce":""),children:$.round?"第".concat($.round,"回合，").concat(m):m})}),!!d&&(0,s.jsx)("div",{children:_?"你的棋盘":"玩家1棋盘"}),(_||!!d)&&(0,s.jsx)("div",{className:"max-w-md mx-auto px-2",children:(0,s.jsxs)("svg",{id:"svg",viewBox:"-58,-52,116,1".concat(d?"10":"34"),xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)(l,{}),_&&!d&&(0,s.jsx)(y,{position:a.position,game:$,updateGameData:h}),!!d&&(0,s.jsx)(j,{showPlane:!0,playerId:_?a.position-1:0,game:$,updateGameData:h})]})}),!!d&&(0,s.jsxs)(s.Fragment,{children:[_&&(0,s.jsx)("div",{className:"mt-2 mb-1 text-xl flex justify-center",children:(0,s.jsx)("span",{className:"".concat(p?"animate-bounce":""),children:"第".concat($.round,"回合，").concat(m)})}),(0,s.jsx)("div",{children:_?"对方棋盘":"玩家2棋盘"}),(0,s.jsx)("div",{className:"max-w-md mx-auto px-2",children:(0,s.jsxs)("svg",{id:"svg",viewBox:"-58,-52,116,110",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)(l,{}),(0,s.jsx)(j,{canBoom:_&&p,playerId:_?2-a.position:1,game:$,updateGameData:h})]})})]}),!_&&(0,s.jsx)("div",{className:"text-2xl mt-2",children:"观战中"})]})},function(t,n){return t.version===n.version}),Z=e(4595),L=function(t){var n=t.room,e=t.game,$=t.send,i=c.f.decode(e.data),o=!!n.position&&n.owner===n.position,l=i.state;return(0,s.jsxs)(s.Fragment,{children:[o&&(0,s.jsx)("div",{className:"button-container",children:(0,s.jsx)("div",{className:"button-right",children:(0,s.jsx)(Z.Z,{small:!0,onClick:function(){return window.confirm("确认结束游戏吗？")&&$(u.Z.OwnerExitGame,{data:c.f.encode({rule:i.rule,planeList:i.planeList,planeCount:i.planeCount}).finish()})},children:"结束游戏"})})}),(0,s.jsx)("div",{className:"flex items-center justify-center text-sm",children:1&i.rule?"模式: 海战棋(炸掉船所有部分，船不能相邻)":"模式: 炸飞机(只需炸掉飞机头)"}),(0,s.jsxs)("div",{className:"flex justify-evenly mt-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)(a.Z,{position:1,player:n.playerList[0],isMe:1===n.position,isOwner:1===n.owner,isTurn:l===r.U.Layout?!i.layoutList[0].length:[r.U.WaitBoth,r.U.WaitPlayer1].includes(l)})}),(0,s.jsx)("div",{children:(0,s.jsx)(a.Z,{position:2,player:n.playerList[1],isMe:2===n.position,isOwner:2===n.owner,isTurn:l===r.U.Layout?!i.layoutList[1].length:[r.U.WaitBoth,r.U.WaitPlayer2].includes(l)})})]}),(0,s.jsx)("div",{className:"mt-2 text-center",children:(0,s.jsx)(g,{game:i,version:e.version,room:n,send:$})})]})}},6787:function(t,n,e){e.r(n);var $=e(7313),u=e(714),a=e(7658),r=e(882);n.default=$.memo(function t(){return(0,$.useMemo)(function(){(0,u.Te)(function(t,n){return r.f.encode((0,a.Lq)(t,n)).finish()})},[]),null})},102:function(t,n,e){e.r(n),e.d(n,{default:function(){return x}});var $=e(1413),u=e(885),a=e(7313),r=e(4595),c=e(5109),i=e(5982),o=e(882),s=e(7658),l=e(2982),f=e(6417),d=function(t){var n=t.id,e=t.index,$=t.zfjRule,c=t.onDelete,i=t.data,o=t.setChanged,d=i.current[n],_=(0,s.xA)($),h=(0,a.useState)(d.b),m=(0,u.Z)(h,2),p=m[0],x=m[1],v=(0,a.useState)(d.a),b=(0,u.Z)(v,2),y=b[0],j=b[1],g=(0,a.useState)(d.c),Z=(0,u.Z)(g,2),L=Z[0],k=Z[1],w=function(t){d.b=t,x(t),o()},C=function(t){d.a=t,j(t),o()},N=function(t){d.c=t,k(t),o()};return(0,f.jsxs)("div",{className:"flex justify-center items-center mx-2",children:[(0,f.jsx)("div",{className:"w-48 flex-shrink",children:(0,f.jsxs)("svg",{id:"svg",viewBox:"-32,-32,64,64",xmlns:"http://www.w3.org/2000/svg",children:[(0,f.jsx)("path",{stroke:"#272E3B",strokeWidth:"0.35",fill:"none",d:"m-30,-30h60v60h-60zm10,0v60m10,0v-60m10,0v60m10,0v-60m10,0v60m10,-10h-60m0,-10h60m0,-10h-60m0,-10h60m0,-10h-60"}),p.map(function(t,n){if(n!==y){var e=n%6;return(0,f.jsx)("rect",{className:"cursor-pointer",width:"10",height:"10",x:10*e-30,y:10*((n-e)/6)-30,fill:t?"#23c343cc":"#00000000",onClick:function(){var t=(0,l.Z)(p);t[n]=1-t[n],y<0?(C(n),1===t[n]&&w(t)):w(t)}},n)}}),y>=0&&(0,f.jsxs)("g",{className:"cursor-pointer",onClick:function(){var t=(0,l.Z)(p);t[y]=0,w(t),C(-1)},children:[(0,f.jsx)("rect",{width:"10",height:"10",x:y%6*10-30,y:10*Math.floor(y/6)-30,fill:$?"#f53f3fdd":"#23c343cc"}),(0,f.jsx)("text",{x:y%6*10-25,y:10*Math.floor(y/6)-25,fontSize:"4",fill:"#000000",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:"○"})]})]})}),(0,f.jsxs)("div",{className:"w-44 text-center",children:[(0,f.jsx)("div",{children:"数量"}),(0,f.jsxs)("div",{className:"mt-2 flex items-center justify-center",children:[(0,f.jsx)(r.Z,{small:!0,disabled:L<=1,onClick:function(){return N(L-1)},children:"－"}),(0,f.jsx)("div",{className:"mx-2 font-mono",children:L}),(0,f.jsx)(r.Z,{small:!0,disabled:L>=9,onClick:function(){return N(L+1)},children:"＋"})]}),(0,f.jsx)("div",{className:"mt-4 h-10 text-sm",children:y<0?"点击格子指定".concat($?"飞机头":"旋转中心"):"点击格子设计".concat(_)}),(0,f.jsx)("div",{className:"mt-2",children:(0,f.jsx)(r.Z,{small:!0,onClick:function(){return c(e,n)},children:"删除该".concat(_)})})]})]})},_=e(3366),h=function(t){var n=t.zfjRule,e=t.changed,$=t.setChanged,c=t.version,i=t.game,o=t.updateGameData,h=(0,s.xA)(n),m=(0,a.useState)(function(){return Array(i.planeList.length).fill(0).map(function(t,n){return n})}),p=(0,u.Z)(m,2),x=p[0],v=p[1],b=(0,a.useRef)(0),y=(0,a.useRef)(function(){var t={};if(b.current)return t;b.current=1;var n=i.planeList,e=i.planeCount;return n&&n.length&&e&&e.length||(n=s.sx[0].planeList,e=s.sx[0].planeCount),n.forEach(function(n,$){for(var a=(0,s.HY)(n),r=(0,u.Z)(a,3),c=r[0],i=r[1],o=r[2],l=[],f=0;f<6;f++)for(var d=0;d<6;d++)l.push(c[f]&&c[f][d]?1:0);t[$]={a:i+6*o,b:l,c:e[$]}}),t}());return(0,a.useEffect)(function(){var t,n=(null===(t=i.planeList)||void 0===t?void 0:t.length)||0;if(n&&n===Object.keys(y.current).length){for(var e=Object.keys(y.current),a=0;a<n;a++){var r=i.planeList[a],c=(0,s.HY)(r),o=(0,u.Z)(c,3),l=o[0],f=o[1],d=o[2],_=y.current[e[a]];if(f+6*d!==_.a||i.planeCount[a]!==_.c||6!==l.length||6!==l[0].length)return;for(var h=0;h<6;h++)for(var m=0;m<6;m++)if(l[h][m]!==_.b[6*h+m])return}$(!1)}},[c]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"text-xs mx-auto px-2 mb-2 max-w-sm text-center",children:["配置不会自动保存，不会实时同步",(0,f.jsx)("br",{}),"需要点击「确认配置」保存、同步给其他玩家"]}),x.map(function(t,e){return(0,f.jsx)(d,{id:t,data:y,setChanged:function(){return $(!0)},index:e,zfjRule:n,onDelete:function(t,n){if($(!0),x.length<2)return(0,_.Z)("至少有一种".concat(h));var e=(0,l.Z)(x);e.splice(t,1),delete y.current[n],v(e)}},t)}),(0,f.jsx)("div",{className:"mt-4",children:(0,f.jsx)(r.Z,{small:!0,onClick:function(){if(x.length>5)return(0,_.Z)("最多6种".concat(h));$(!0);var t=(0,l.Z)(x),n=x[x.length-1]+1;t.push(n),y.current[n]={c:1,a:-1,b:Array(36).fill(0)},v(t)},children:"增加一种".concat(h)})}),(0,f.jsx)("div",{className:"mt-8",children:(0,f.jsx)(r.Z,{primary:!0,disabled:!e,onClick:function(){for(var t="配置存在错误！",e=Object.keys(y.current),$=0,u=0;u<e.length;u++){var a=e[u],r=y.current[a];if(r.a<0)return(0,_.Z)("".concat(t,"所有").concat(h,"都必须有").concat(n?"飞机头":"旋转中心"));if(r.c<1||r.c>9)return(0,_.Z)("".concat(t,"每种").concat(h,"数量需要在1-9之间"));$+=r.b.filter(function(t){return t}).length*r.c}if($>50)return(0,_.Z)("".concat(t,"所有").concat(h,"的面积之和不能超过50"));for(var c=[],i=[],l=0;l<e.length;l++){for(var f=e[l],d=y.current[f],m=[],p=0;p<6;p++){for(var x=[],v=0;v<6;v++)x.push(d.b[v+6*p]);m.push(x)}c.push(Uint8Array.from((0,s.Es)(m,d.a))),i.push(d.c)}o({planeList:c,planeCount:i})},children:"确认配置"})})]})},m=function(t){var n=t.zfjRule,e=t.data,$=t.count,a=(0,s.HY)(e),r=(0,u.Z)(a,3),c=r[0],i=r[1],o=r[2],l=[];c.forEach(function(t){t.forEach(function(t){l.push(t)})});var d=i+6*o;return(0,f.jsxs)("div",{className:"flex justify-center items-center mx-2",children:[(0,f.jsx)("div",{className:"w-36 flex-shrink",children:(0,f.jsxs)("svg",{id:"svg",viewBox:"-32,-32,64,64",xmlns:"http://www.w3.org/2000/svg",children:[(0,f.jsx)("path",{stroke:"#272E3B",strokeWidth:"0.35",fill:"none",d:"m-30,-30h60v60h-60zm10,0v60m10,0v-60m10,0v60m10,0v-60m10,0v60m10,-10h-60m0,-10h60m0,-10h-60m0,-10h60m0,-10h-60"}),l.map(function(t,n){if(n!==d){var e=n%6;return(0,f.jsx)("rect",{width:"10",height:"10",x:10*e-30,y:10*((n-e)/6)-30,fill:t?"#23c343cc":"#00000000"},n)}}),(0,f.jsx)("rect",{width:"10",height:"10",x:d%6*10-30,y:10*Math.floor(d/6)-30,fill:n?"#f53f3fdd":"#23c343cc"}),(0,f.jsx)("text",{x:d%6*10-25,y:10*Math.floor(d/6)-25,fontSize:"4",fill:"#000000",textAnchor:"middle",alignmentBaseline:"central",dominantBaseline:"central",children:"○"})]})}),(0,f.jsxs)("div",{className:"w-24 text-center",children:[(0,f.jsx)("div",{children:"数量"}),(0,f.jsx)("div",{className:"mt-2 flex items-center justify-center",children:(0,f.jsx)("div",{className:"font-mono",children:$})})]})]})},p=function(t){if(!t.planeList||!t.planeList.length)return!1;var n=(0,s.HY)(t.planeList[0]),e=(0,u.Z)(n,1)[0];return 6===e.length&&6===e[0].length},x=function(t){var n=t.room,e=t.game,l=t.send,d=o.f.decode(e.data),_=(0,a.useState)(function(){return p(d)}),x=(0,u.Z)(_,2),v=x[0],b=x[1],y=(0,a.useState)(!1),j=(0,u.Z)(y,2),g=j[0],Z=j[1],L=!(1&d.rule),k=(0,s.xA)(L),w=!!n.position&&n.position===n.owner,C=function(t){l(i.Z.OwnerUpdateGameData,{data:o.f.encode((0,$.Z)({rule:d.rule},t)).finish()})};return(0,f.jsxs)(c.Z,{room:n,game:e,send:l,startDisabled:g,children:[(0,f.jsx)("div",{children:L?"模式：炸飞机":"模式：海战棋"}),(0,f.jsx)("div",{children:L?"（只需炸掉飞机头）":"（炸掉战舰所有部分，战舰不能相邻）"}),w?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"text-center mt-2",children:(0,f.jsx)(r.Z,{small:!0,onClick:function(){v&&Z(!0),l(i.Z.OwnerUpdateGameData,{data:o.f.encode(L?s.sx[1]:s.sx[0]).finish()})},children:"切换模式"})}),(0,f.jsx)("div",{className:"mt-8",children:v?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(r.Z,{className:"mb-4",small:!0,onClick:function(){window.confirm("所有自定义配置不会保存，确认恢复默认配置吗？")&&(C(L?s.sx[0]:s.sx[1]),b(!1))},children:"放弃自定义，恢复默认配置"}),(0,f.jsx)(h,{zfjRule:L,changed:g,setChanged:Z,game:d,version:e.version,updateGameData:C})]}):(0,f.jsx)(r.Z,{small:!0,onClick:function(){return b(!0)},children:"自定义".concat(k)})})]}):p(d)&&(0,f.jsxs)("div",{className:"text-center mt-2",children:[(0,f.jsx)("div",{className:"text-sm",children:"本局采用自定义配置"}),(0,f.jsx)("div",{children:d.planeList.map(function(t,n){return(0,f.jsx)(m,{zfjRule:L,data:t,count:d.planeCount[n]},n)})})]})]})}},3032:function(t,n,e){var $,u;e.d(n,{U:function(){return $}}),(u=$||($={}))[u.Layout=0]="Layout",u[u.WaitPlayer1=1]="WaitPlayer1",u[u.WaitPlayer2=2]="WaitPlayer2",u[u.WaitBoth=3]="WaitBoth",u[u.Player1Win=64]="Player1Win",u[u.Player2Win=65]="Player2Win"},882:function(t,n,e){e.d(n,{f:function(){return i}});var $=e(7710),u=$.Reader,a=$.Writer,r=$.util,c=$.roots.default||($.roots.default={}),i=c.ZFJGameData=function(){function t(t){if(this.planeList=[],this.planeCount=[],this.layoutList=[],this.attackList=[],this.lastAttackList=[],t)for(var n=Object.keys(t),e=0;e<n.length;++e)null!=t[n[e]]&&(this[n[e]]=t[n[e]])}return t.prototype.rule=0,t.prototype.planeList=r.emptyArray,t.prototype.planeCount=r.emptyArray,t.prototype.state=0,t.prototype.layoutList=r.emptyArray,t.prototype.attackList=r.emptyArray,t.prototype.round=0,t.prototype.lastAttackList=r.emptyArray,t.encode=function(t,n){if(n||(n=a.create()),null!=t.rule&&Object.hasOwnProperty.call(t,"rule")&&n.uint32(8).uint32(t.rule),null!=t.planeList&&t.planeList.length)for(var e=0;e<t.planeList.length;++e)n.uint32(18).bytes(t.planeList[e]);if(null!=t.planeCount&&t.planeCount.length){for(n.uint32(26).fork(),e=0;e<t.planeCount.length;++e)n.uint32(t.planeCount[e]);n.ldelim()}if(null!=t.state&&Object.hasOwnProperty.call(t,"state")&&n.uint32(32).uint32(t.state),null!=t.layoutList&&t.layoutList.length)for(e=0;e<t.layoutList.length;++e)n.uint32(42).bytes(t.layoutList[e]);if(null!=t.attackList&&t.attackList.length)for(e=0;e<t.attackList.length;++e)n.uint32(50).bytes(t.attackList[e]);if(null!=t.round&&Object.hasOwnProperty.call(t,"round")&&n.uint32(56).uint32(t.round),null!=t.lastAttackList&&t.lastAttackList.length){for(n.uint32(66).fork(),e=0;e<t.lastAttackList.length;++e)n.uint32(t.lastAttackList[e]);n.ldelim()}return n},t.decode=function(t,n){t instanceof u||(t=u.create(t));for(var e=void 0===n?t.len:t.pos+n,$=new c.ZFJGameData;t.pos<e;){var a=t.uint32();switch(a>>>3){case 1:$.rule=t.uint32();break;case 2:$.planeList&&$.planeList.length||($.planeList=[]),$.planeList.push(t.bytes());break;case 3:if($.planeCount&&$.planeCount.length||($.planeCount=[]),2==(7&a))for(var r=t.uint32()+t.pos;t.pos<r;)$.planeCount.push(t.uint32());else $.planeCount.push(t.uint32());break;case 4:$.state=t.uint32();break;case 5:$.layoutList&&$.layoutList.length||($.layoutList=[]),$.layoutList.push(t.bytes());break;case 6:$.attackList&&$.attackList.length||($.attackList=[]),$.attackList.push(t.bytes());break;case 7:$.round=t.uint32();break;case 8:if($.lastAttackList&&$.lastAttackList.length||($.lastAttackList=[]),2==(7&a))for(r=t.uint32()+t.pos;t.pos<r;)$.lastAttackList.push(t.uint32());else $.lastAttackList.push(t.uint32());break;default:t.skipType(7&a)}}return $},t}()},7658:function(t,n,e){e.d(n,{Es:function(){return p},HY:function(){return x},IH:function(){return L},Lq:function(){return m},_B:function(){return g},sx:function(){return h},xA:function(){return _},xU:function(){return Z}});var $=e(2982),u=e(885),a=e(882),r=e(3032),c=e(8540),i=Uint8Array.from([]),o=Uint8Array.from([140,34,124,142]),s=(Uint8Array.from([0,8]),Uint8Array.from([32,12])),l=Uint8Array.from([64,14]),f=Uint8Array.from([96,15]),d=Uint8Array.from([128,15,128]),_=function(t){return t?"飞机":"战舰"},h=[{rule:0,planeList:[o],planeCount:[3]},{rule:1,planeList:[s,l,f,d],planeCount:[1,2,1,1]}],m=function(t,n){var e=a.f.decode(n),$=1&e.rule,u=e.planeCount,c=e.planeList,o=u.length===c.length&&u.length>0&&u.every(function(t){return t>0});return{rule:$,planeList:o?c:h[$].planeList,planeCount:o?u:h[$].planeCount,state:r.U.Layout,layoutList:[i,i],attackList:[i,i],round:0,lastAttackList:[0,0]}},p=function(t,n){var e,a=t.length,r=t[0].length,i=[],o=0,s=0,l=(0,c.F)(s,o,r-1,3),f=(0,u.Z)(l,3);s=f[0],o=f[1],e=f[2],i.push.apply(i,(0,$.Z)(e));var d=(0,c.F)(s,o,a-1,3),_=(0,u.Z)(d,3);s=_[0],o=_[1],e=_[2],i.push.apply(i,(0,$.Z)(e));var h=(0,c.F)(s,o,n,6),m=(0,u.Z)(h,3);s=m[0],o=m[1],e=m[2],i.push.apply(i,(0,$.Z)(e));for(var p=0;p<a;p++)for(var x=0;x<r;x++){var v=(0,c.F)(s,o,t[p][x]?1:0,1),b=(0,u.Z)(v,3);s=b[0],o=b[1],e=b[2],i.push.apply(i,(0,$.Z)(e))}return o&&i.push(s),i},x=function(t){var n,e=0,$=(0,c.l)(t,e,3),a=(0,u.Z)($,2);n=a[0],e=a[1];var r=n+1,i=(0,c.l)(t,e,3),o=(0,u.Z)(i,2);n=o[0],e=o[1];var s=n+1,l=(0,c.l)(t,e,6),f=(0,u.Z)(l,2);n=f[0],e=f[1];for(var d=n,_=[],h=0;h<s;h++){for(var m=[],p=0;p<r;p++){var x=(0,c.l)(t,e,1),v=(0,u.Z)(x,2);n=v[0],e=v[1],m.push(n)}_.push(m)}return[_,d%r,Math.floor(d/r)]};function v(t,n,e){return[t,n,e]}function b(t,n,e){for(var $=t.length,u=t[0].length,a=[],r=0;r<u;r++){for(var c=[],i=$-1;i>=0;i--)c.push(t[i][r]);a.push(c)}return[a,$-1-e,n]}function y(t,n,e){for(var $=t.length,u=t[0].length,a=[],r=$-1;r>=0;r--){for(var c=[],i=u-1;i>=0;i--)c.push(t[r][i]);a.push(c)}return[a,u-1-n,$-1-e]}function j(t,n,e){for(var $=t.length,u=t[0].length,a=[],r=u-1;r>=0;r--){for(var c=[],i=0;i<$;i++)c.push(t[i][r]);a.push(c)}return[a,e,u-1-n]}var g=function(t,n,e,$){return(0,[v,b,y,j][$])(t,n,e)},Z=function(t,n,e,$){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=g(t,n,e,$),i=(0,u.Z)(c,3),o=i[0],s=i[1],l=i[2],f=a-s,d=r-l,_=[];return o.forEach(function(t,n){t.forEach(function(t,e){t&&_.push([e+f,n+d])})}),[_,s,l]},L=function(t,n){var e=t.map(function(t){return x(t)}),$=[];return e.forEach(function(t,e){for(var u=0;u<n[e];u++)$.push(t)}),$}},2982:function(t,n,e){e.d(n,{Z:function(){return a}});var $=e(907),u=e(181);function a(t){return function(t){if(Array.isArray(t))return(0,$.Z)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||(0,u.Z)(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}}]);console.log('Breaker script injected successfully!');